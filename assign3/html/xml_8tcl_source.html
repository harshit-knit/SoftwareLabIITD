<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Weather Application: code1/xml.tcl Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>code1/xml.tcl</h1>  </div>
</div>
<div class="contents">
<a href="xml_8tcl.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#!/usr/bin/tclsh</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">## \file xml.tcl</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor"># File documentation.</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">#\verbatim</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor"># Startup code:\</span>
<a name="l00006"></a>00006 <span class="preprocessor">#\endverbatim</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>
<a name="l00008"></a>00008 <span class="preprocessor">#\code</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">## This script is required for Weather Processing</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="keyword">package </span>require xml
<a name="l00012"></a>00012 ##package for dom(Document Object Model Processing
<a name="l00013"></a>00013 package require dom
<a name="l00014"></a>00014 package require http
<a name="l00015"></a>00015 package require tdom
<a name="l00016"></a>00016 ##package for Mysql Connection And Query
<a name="l00017"></a>00017 package require mysqltcl
<a name="l00018"></a>00018 set m [mysqlconnect -user root  -password 123456]
<a name="l00019"></a>00019 mysqluse $m weather
<a name="l00020"></a>00020 #set xmlSrc [http::data [http::geturl http:<span class="comment">//weather.yahooapis.com/forecastrss?w=2442047&amp;u=c ] ]</span>
<a name="l00021"></a>00021 set query [lindex $argv 0]
<a name="l00022"></a>00022 set appid {[_1cH2kXV34FL_bAdDqGfPMn3y5t7uCUwqNSjWUC8x81suAiFT33B7dksj3Wb.ZN66BRdo8V2khicXM0WliWFi2mbk0rHAVE-]}
<a name="l00023"></a>00023 ## finding Woeid of location using yahoo NetGeoLocation API
<a name="l00024"></a>00024 set url &quot;http:<span class="comment">//where.yahooapis.com/v1/places.q($query)?appid=$appid&quot;</span>
<a name="l00025"></a>00025 ##saving results to location.xml 
<a name="l00026"></a>00026 exec wget -O location.xml $url  2&gt;&amp;1 &gt;/dev/null
<a name="l00027"></a>00027 ## parsing location.xml to get woeid of a location
<a name="l00028"></a>00028 set f [open location.xml r]
<a name="l00029"></a>00029 set xmlSource [read $f ]
<a name="l00030"></a>00030 set xmlSource [string trim $xmlSource]
<a name="l00031"></a>00031 set d [dom parse -html $xmlSource]
<a name="l00032"></a>00032 set r [$d documentElement ]
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 set woeid [$r selectNodes {string(/places/place/woeid)}]
<a name="l00035"></a>00035 ##saving weather results to forecast.xml using Yahoo Weather API
<a name="l00036"></a>00036 exec wget -O forecast.xml &quot;http:<span class="comment">//weather.yahooapis.com/forecastrss?w=$woeid&amp;u=c&quot; 2&gt;&amp;1 &gt;/dev/null</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 set fd [open forecast.xml r]
<a name="l00039"></a>00039 set xmlSrc [read $fd]
<a name="l00040"></a>00040 set xmlSrc [string trim $xmlSrc]
<a name="l00041"></a>00041 set dom [dom parse $xmlSrc]
<a name="l00042"></a>00042 set root [$dom documentElement &quot;rss&quot;]
<a name="l00043"></a>00043 ##parsing forecast.xml to get city ,region and country
<a name="l00044"></a>00044 set title [$root selectNodes {string(/rss/channel/title)}]
<a name="l00045"></a>00045 set location(city) [$root selectNodes {string(/rss/channel/yweather:location/@city)}] 
<a name="l00046"></a>00046 set location(region) [$root selectNodes {string(/rss/channel/yweather:location/@region)}] 
<a name="l00047"></a>00047 set location(country) [$root selectNodes {string(/rss/channel/yweather:location/@country)}] 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 set qw &quot;delete from location where woeid=&#39;$woeid&#39;&quot;
<a name="l00050"></a>00050 set q1 [ mysqlexec $m  $qw  ] 
<a name="l00051"></a>00051 ##inserting woied and location into table location
<a name="l00052"></a>00052 set quer &quot;insert into location values (&#39;$woeid&#39;,&#39;$location(city)&#39;,&#39;$location(region)&#39;,&#39;$location(country)&#39;)&quot; 
<a name="l00053"></a>00053 set r [mysqlexec $m  $quer ]
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 ## paring forecast.xml to get temperature distance pressure and speed
<a name="l00057"></a>00057 set units(temperature) [$root selectNodes {string(/rss/channel/yweather:units/@temperature)}] 
<a name="l00058"></a>00058 set units(distance) [$root selectNodes {string(/rss/channel/yweather:units/@distance)}] 
<a name="l00059"></a>00059 set units(pressure) [$root selectNodes {string(/rss/channel/yweather:units/@pressure)}] 
<a name="l00060"></a>00060 set units(speed) [$root selectNodes {string(/rss/channel/yweather:units/@pressure)}] 
<a name="l00061"></a>00061 ## paring forecast.xml to get wind Chill, direction,Speed
<a name="l00062"></a>00062 set wind(chill) [$root selectNodes {string(/rss/channel/yweather:wind/@chill)}] 
<a name="l00063"></a>00063 set wind(direction) [$root selectNodes {string(/rss/channel/yweather:wind/@direction)}] 
<a name="l00064"></a>00064 set wind(speed) [$root selectNodes {string(/rss/channel/yweather:wind/@speed)}] 
<a name="l00065"></a>00065 ## paring forecast.xml to get humidity , visibility, pressure,rising of atmosphere
<a name="l00066"></a>00066 set atmosphere(humidity) [$root selectNodes {string(/rss/channel/yweather:atmosphere/@humidity)}] 
<a name="l00067"></a>00067 set atmosphere(visibility) [$root selectNodes {string(/rss/channel/yweather:atmosphere/@visibility)}] 
<a name="l00068"></a>00068 set atmosphere(pressure) [$root selectNodes {string(/rss/channel/yweather:atmosphere/@pressure)}] 
<a name="l00069"></a>00069 set atmosphere(rising) [$root selectNodes {string(/rss/channel/yweather:atmosphere/@rising)}]
<a name="l00070"></a>00070  ## paring forecast.xml to get sunset and sunrise results 
<a name="l00071"></a>00071 set astronomy(sunrise) [$root selectNodes {string(/rss/channel/yweather:astronomy/@sunrise)}] 
<a name="l00072"></a>00072 set astronomy(sunset) [$root selectNodes {string(/rss/channel/yweather:astronomy/@sunset)}]
<a name="l00073"></a>00073 ## paring forecast.xml to get current temperature and weather condition
<a name="l00074"></a>00074 set condition(text) [$root selectNodes {string(/rss/channel/item/yweather:condition/@text)}] 
<a name="l00075"></a>00075 set condition(code) [$root selectNodes {string(/rss/channel/item/yweather:condition/@code)}] 
<a name="l00076"></a>00076 set condition(temp) [$root selectNodes {string(/rss/channel/item/yweather:condition/@temp)}] 
<a name="l00077"></a>00077 set condition(date) [$root selectNodes {string(/rss/channel/item/yweather:condition/@date)}] 
<a name="l00078"></a>00078 ##saving todays weather result to todays.txt
<a name="l00079"></a>00079 set ou [open today.txt w]
<a name="l00080"></a>00080 puts $ou &quot;WIND       \t\t Chill \t:\t $wind(chill)&quot;
<a name="l00081"></a>00081 puts $ou &quot;Parameters \t\tDirection \t:\t $wind(direction)&quot;
<a name="l00082"></a>00082 puts $ou &quot;\t\t Speed \t:\t $wind(speed) $units(speed)&quot;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 puts $ou &quot; Atmosphere \t \tHumidity \t:\t $atmosphere(humidity)&quot;
<a name="l00085"></a>00085 puts $ou &quot;Parametres \t\tVisibility \t:\t $atmosphere(visibility)&quot;
<a name="l00086"></a>00086 puts $ou &quot;\t\t\t Pressure \t:\t $atmosphere(pressure) $units(pressure)&quot;
<a name="l00087"></a>00087 puts $ou &quot;\t\t\tRising   \t:\t $atmosphere(rising)&quot;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 puts $ou &quot;Astronomy \t\tSunrise \t:\t $astronomy(sunrise)&quot;
<a name="l00090"></a>00090 puts $ou &quot;Parameters \t\tSunset  \t:\t $astronomy(sunset)&quot;
<a name="l00091"></a>00091 puts $ou &quot;\t\tWeather Conditions\t&quot;
<a name="l00092"></a>00092 puts $ou &quot;Date       \t:\t $condition(date)&quot;
<a name="l00093"></a>00093 puts $ou &quot;Temperature \t:\t $condition(temp) $units(temperature)&quot;
<a name="l00094"></a>00094 puts $ou &quot;Conditions \t:\t $condition(text)&quot;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 close $ou
<a name="l00097"></a>00097 ## paring forecast.xml to get Future Weather Predictions of 5 days
<a name="l00098"></a>00098 foreach forecast [$root selectNodes &quot;/rss/channel/item/yweather:forecast&quot;] {
<a name="l00099"></a>00099 set day [$forecast getAttribute day]
<a name="l00100"></a>00100 set date [$forecast  getAttribute date]
<a name="l00101"></a>00101 set low [$forecast  getAttribute low]
<a name="l00102"></a>00102 set high [$forecast getAttribute high]
<a name="l00103"></a>00103 set text [$forecast  getAttribute text]
<a name="l00104"></a>00104 set code [$forecast  getAttribute code]
<a name="l00105"></a>00105 set qur &quot;delete  from forecast where woeid=&#39;$woeid&#39; and date=&#39;$date&#39;&quot;
<a name="l00106"></a>00106 set q [ mysqlsel $m  $qur -flatlist ] 
<a name="l00107"></a>00107 ## inserting Weather predictions into table forecast
<a name="l00108"></a>00108 set quer &quot;insert into forecast values (&#39;$woeid&#39;,&#39;$date&#39;,&#39;$day&#39;,&#39;$low&#39;,&#39;$high&#39;,&#39;$text&#39;,&#39;$code&#39;)&quot; 
<a name="l00109"></a>00109 set r [mysqlexec $m  $quer ]
<a name="l00110"></a>00110 } 
<a name="l00111"></a>00111 ## reading city region,country from mysql database
<a name="l00112"></a>00112 set o [open loc.txt w]
<a name="l00113"></a>00113 set out [open todays.txt w]
<a name="l00114"></a>00114 set qer &quot;select city,region,country from location where woeid=&#39;$woeid&#39;&quot;
<a name="l00115"></a>00115 set q [mysqlsel $m $qer -flatlist ]
<a name="l00116"></a>00116 puts $o $q
<a name="l00117"></a>00117 ## reading  weather Predictions from mysql database and save into file
<a name="l00118"></a>00118 set qer &quot;select date,day,low,high,text from forecast where woeid=&#39;$woeid&#39;&quot;
<a name="l00119"></a>00119 foreach {a b c d e} [mysqlsel $m $qer -flatlist ] {
<a name="l00120"></a>00120 puts $out &quot;$a \t   $b \t\t$c \t\t$d \t$e&quot;
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 close $o
<a name="l00123"></a>00123 close $out
<a name="l00124"></a>00124 source abcd.tcl
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127  
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Apr 3 2014 12:18:28 for Weather Application by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
